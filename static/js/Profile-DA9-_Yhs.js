import{l as e,r as l,K as T,U,z as g,L as O,k as S,y as L,M as P,N as C}from"./index-Bxvt32Fn.js";import{c as q,f as w,g as y}from"./date-DxB7P7Xg.js";import{i as v}from"./validator-CEpkGiwj.js";import{o as E}from"./index.module-DK4_OHVx.js";import{m as _,a as k,b as R,c as B,d as M}from"./chunk-II5OMS4Q-BxdYPM8K.js";import{i as F}from"./chunk-TC4QW7OA-BR1MQ8kt.js";import{i as H}from"./chunk-OFGZKCFR-DMD41YH-.js";import{a as $}from"./chunk-LSZJW3GU-_IDEUZgR.js";import{d as D,a as z,b as A,m as j}from"./chunk-L6QJ42W6-DkGgdWon.js";import"./chunk-M3MASYO7-BCjy7JXE.js";import"./import-DGHSTZk5.js";import"./Combination-DzHVXwRp.js";import"./chunk-CAFRINWI-CcU5yOMx.js";import"./index-BHTssK_p.js";import"./index-DFOjVUWo.js";import"./chunk-3YBC73XM-BC-oLrZW.js";import"./import-C0LPorT5.js";import"./import-BYAPuWd2.js";import"./chunk-44JHHBS2-BrNNn6kB.js";const I=t=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...t,children:e.jsx("path",{d:"M480-480q33 0 56.5-23.5T560-560q0-33-23.5-56.5T480-640q-33 0-56.5 23.5T400-560q0 33 23.5 56.5T480-480Zm0 294q122-112 181-203.5T720-552q0-109-69.5-178.5T480-800q-101 0-170.5 69.5T240-552q0 71 59 162.5T480-186Zm0 106Q319-217 239.5-334.5T160-552q0-150 96.5-239T480-880q127 0 223.5 89T800-552q0 100-79.5 217.5T480-80Zm0-480Z"})}),V=t=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...t,children:e.jsx("path",{d:"m80-80 200-560 360 360L80-80Zm132-132 282-100-182-182-100 282Zm370-246-42-42 224-224q32-32 77-32t77 32l24 24-42 42-24-24q-14-14-35-14t-35 14L582-458ZM422-618l-42-42 24-24q14-14 14-34t-14-34l-26-26 42-42 26 26q32 32 32 76t-32 76l-24 24Zm80 80-42-42 144-144q14-14 14-35t-14-35l-64-64 42-42 64 64q32 32 32 77t-32 77L502-538Zm160 160-42-42 64-64q32-32 77-32t77 32l64 64-42 42-64-64q-14-14-35-14t-35 14l-64 64ZM212-212Z"})}),G=t=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...t,children:e.jsx("path",{d:"M200-80q-33 0-56.5-23.5T120-160v-560q0-33 23.5-56.5T200-800h40v-80h80v80h320v-80h80v80h40q33 0 56.5 23.5T840-720v560q0 33-23.5 56.5T760-80H200Zm0-80h560v-400H200v400Zm0-480h560v-80H200v80Zm0 0v-80 80Zm280 240q-17 0-28.5-11.5T440-440q0-17 11.5-28.5T480-480q17 0 28.5 11.5T520-440q0 17-11.5 28.5T480-400Zm-160 0q-17 0-28.5-11.5T280-440q0-17 11.5-28.5T320-480q17 0 28.5 11.5T360-440q0 17-11.5 28.5T320-400Zm320 0q-17 0-28.5-11.5T600-440q0-17 11.5-28.5T640-480q17 0 28.5 11.5T680-440q0 17-11.5 28.5T640-400ZM480-240q-17 0-28.5-11.5T440-280q0-17 11.5-28.5T480-320q17 0 28.5 11.5T520-280q0 17-11.5 28.5T480-240Zm-160 0q-17 0-28.5-11.5T280-280q0-17 11.5-28.5T320-320q17 0 28.5 11.5T360-280q0 17-11.5 28.5T320-240Zm320 0q-17 0-28.5-11.5T600-280q0-17 11.5-28.5T640-320q17 0 28.5 11.5T680-280q0 17-11.5 28.5T640-240Z"})}),J=t=>{try{return BigInt(t)}catch{return}},K=({isOpen:t,onOpenChange:d,username:s,onUsernameChange:i})=>{const[r,n]=l.useState(s),[u,x]=l.useState(!1),[f]=E(r,1e3),{show:h}=T();return l.useEffect(()=>{if(f&&f!==s){if(!v(f)){x(!1);return}U({username:f,checkOnly:!0}).then(c=>{var a,m;if(!((a=c.data)!=null&&a.status)){x(!1),c.statusCode===200?h({message:"username already used"}):h({message:(m=c.data)==null?void 0:m.msg});return}x(!0)}).catch(c=>{h({message:c})})}else x(!1)},[f]),l.useEffect(()=>{n(s)},[s]),e.jsx(_,{isOpen:t,onOpenChange:c=>{n(s),d(c)},children:e.jsx(k,{children:c=>e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"flex flex-col gap-1",children:"Change your username"}),e.jsx(B,{children:e.jsx(F,{className:"font-medium",placeholder:"iTrans unique username",startContent:e.jsx("p",{className:"font-bold",children:"@"}),value:r,onValueChange:a=>{n(a)},errorMessage:v(r)?"":"invalid username"})}),e.jsxs(M,{children:[e.jsx(g,{color:"danger",variant:"light",onPress:c,children:"Cancel"}),e.jsx(g,{color:"primary",isDisabled:!u||r===s||!v(r),onPress:()=>{i(r),c()},children:"Submit"})]})]})})})},Y=t=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...t,children:e.jsx("path",{d:"M480-260q75 0 127.5-52.5T660-440q0-75-52.5-127.5T480-620q-75 0-127.5 52.5T300-440q0 75 52.5 127.5T480-260Zm0-80q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29ZM160-120q-33 0-56.5-23.5T80-200v-480q0-33 23.5-56.5T160-760h126l74-80h240l74 80h126q33 0 56.5 23.5T880-680v480q0 33-23.5 56.5T800-120H160Zm0-80h640v-480H638l-73-80H395l-73 80H160v480Zm320-240Z"})}),Q=t=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...t,children:e.jsx("path",{d:"M480-280q17 0 28.5-11.5T520-320q0-17-11.5-28.5T480-360q-17 0-28.5 11.5T440-320q0 17 11.5 28.5T480-280Zm-40-160h80v-240h-80v240ZM330-120 120-330v-300l210-210h300l210 210v300L630-120H330Zm34-80h232l164-164v-232L596-760H364L200-596v232l164 164Zm116-280Z"})}),W=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],Z=(t,d=2)=>{if(t==0)return"0 Bytes";const s=1024,i=Math.floor(Math.log(t)/Math.log(s));return parseFloat((t/Math.pow(s,i)).toFixed(d))+" "+W[i]},X=({maxUploadSize:t=3<<20,onSetHook:d,onUpload:s,onCancel:i})=>{const[r,n]=l.useState(null),[u,x]=l.useState(""),[f,h]=l.useState(!1),c=l.useRef(null),{show:a}=T(),m=()=>{URL.revokeObjectURL(u),h(!1),r&&s(r)};return l.useEffect(()=>{r&&(x(URL.createObjectURL(r)),h(!0))},[r]),l.useEffect(()=>{d(()=>()=>{var o;(o=c.current)==null||o.click()})},[d,c.current]),e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",id:"photo-uploader",ref:c,className:"hidden",accept:"image/png, image/jped, image/gif, image/webp",onChange:o=>{if(o.target.files&&o.target.files.length===1){const p=o.target.files.item(0);if(!p)return;if(p.size>t){a({message:`current file too large (${Z(p.size)}), max: ${Z(t)}`});return}n(p)}}}),e.jsx(_,{isOpen:f,onOpenChange:o=>{URL.revokeObjectURL(u),h(o),!o&&i&&i()},children:e.jsx(k,{children:o=>e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"flex flex-col gap-1",children:"Confirm the image you are about to upload"}),e.jsx(B,{className:"flex items-center justify-center",children:e.jsx(H,{style:{maxWidth:"256px",maxHeight:"256px"},src:u,alt:"Preview image"})}),e.jsxs(M,{children:[e.jsx(g,{color:"danger",variant:"light",onPress:()=>{o(),URL.revokeObjectURL(u),i&&i()},children:"Cancel"}),e.jsx(g,{color:"primary",onPress:m,children:"Upload"})]})]})})})]})};var b=(t=>(t.Avatar="/file/avatar",t.Custom="",t))(b||{});const N=new Map,ee=async(t="/file/avatar",d)=>{let s;switch(t){case"/file/avatar":s=`/file/avatar/${d}`;break;case"":s=d;break}const i=N.get(s);if(i)return i;const r=await O("GET",s,{mustJSON:!1,local:t===""}),n=URL.createObjectURL(r.blob);return N.set(s,n),n},te=S((t,d)=>{const[s,i]=l.useState("");l.useEffect(()=>{t.src&&ee(t.fixedsrc?b.Custom:b.Avatar,t.src).then(n=>{i(n)})},[]);const r=Object.keys(t).filter(n=>n!=="fixedsrc").reduce((n,u)=>(n[u]=t[u],n),{});return e.jsx($,{ref:d,...r,src:s})}),be=()=>{const[t,d]=l.useState({type:"self"}),[s,i]=l.useState({firstname:"",lastname:"System",createdAt:new Date}),[r,n]=l.useState({isOpen:!1,username:""}),[u,x]=l.useState(()=>{}),{profile:f}=L(),{show:h}=T(),c=P();return l.useEffect(()=>{const a=c.id;if(!a)return;if(v(a)){d({type:"username",username:a});return}const m=J(a);if(m){d({type:"userID",userID:m});return}},[]),l.useEffect(()=>{switch(t.type){case"username":U({username:t.username}).then(a=>{var m,o,p;if(!((m=a.data)!=null&&m.data)||!((o=a.data)!=null&&o.status)){h({message:(p=a.data)==null?void 0:p.msg});return}i({...a.data.data})}).catch(a=>{h({message:a})});break;case"userID":h({message:"unsupported query method"});break;case"self":if(!f){h({message:"failed to get user profile"});return}i({...f});break}},[t]),e.jsxs("div",{children:[e.jsx(K,{isOpen:r.isOpen,onOpenChange:a=>{n({...r,isOpen:a})},username:s.username,onUsernameChange:a=>{n({...r,username:a}),a&&C({username:a}).then(m=>{var o,p;if(!((o=m.data)!=null&&o.status)){h({message:(p=m.data)==null?void 0:p.msg});return}i({...s,username:a})}).catch(m=>{h({message:m})})}}),e.jsx(X,{maxUploadSize:10<<20,onSetHook:x,onUpload:a=>{console.log("on uploader",a)}}),e.jsx("div",{style:{backgroundSize:"cover",backgroundImage:`url('${s.background?s.background:"/default-background.png"}')`,backgroundPosition:"center",backgroundRepeat:"no-repeat",height:"200px"},children:e.jsxs(D,{size:"sm",placement:"right-end",children:[e.jsx(z,{children:e.jsx(te,{fixedsrc:!s.avatar,style:{position:"relative",zIndex:10,top:"100%",left:"5%",transform:"translate(-5%, -50%)",width:"20vh",height:"auto",userSelect:"none"},alt:s.firstname,src:s.avatar||"/default-avatar.jpg",name:s.firstname,showFallback:!0})}),e.jsxs(A,{"aria-label":"avatar action",title:"Actions",children:[t.type==="self"&&s?e.jsx(j,{startContent:e.jsx(Y,{width:"1.25rem",height:"1.25rem"}),onPress:u,textValue:"Upload photo",children:e.jsx("span",{className:"font-medium",children:"Upload photo"})},"select-new-photo"):e.jsx(j,{className:"hidden",textValue:"hidden item",isReadOnly:!0}),t.type!=="self"&&s?e.jsx(j,{color:"danger",className:"text-danger",startContent:e.jsx(Q,{width:"1.25rem",height:"1.25rem"}),textValue:"Report this user",children:e.jsx("span",{className:"font-medium",children:"Report this user"})},"report-this-user"):e.jsx(j,{className:"hidden",textValue:"hidden item",isReadOnly:!0})]})]})}),e.jsx(g,{style:{position:"relative",zIndex:10,top:"100%",left:"95%",transform:"translate(-95%, 50%)"},color:"primary",variant:"bordered",radius:"lg",children:"Edit your profile"}),e.jsx("div",{className:"flex items-center mt-16 dark:bg-black",style:{marginTop:"10vh",width:"90%",transform:"translate(5%, 0%)"},children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-4xl font-bold",children:[s.firstname," ",s.lastname,e.jsxs("span",{className:`${t.type!=="self"?"hidden":""} ml-3 font-normal text-small text-gray-500 dark:text-gray-400 hover:underline`,onClick:()=>n({...r,isOpen:!0}),children:["@",s.username||"SET YOUR USERNAME"]})]}),e.jsxs("p",{className:`${s.bio?"":"hidden"} font-medium`,children:["Bio:",e.jsx("span",{className:"ml-1 font-normal text-gray-600 dark:text-gray-300",children:s.bio})]}),e.jsxs("div",{className:"mt-5 whitespace-pre-wrap inline",children:[e.jsxs(q,{variant:"bordered",className:`${s.location?"mr-2":"hidden"}`,children:[e.jsx(I,{width:"1rem",height:"1rem"}),e.jsx("span",{className:"ml-1",children:s.location})]}),e.jsxs(q,{variant:"bordered",className:`${s.birthday?"mt-1 mr-2":"hidden"}`,children:[e.jsx(V,{width:"1rem",height:"1rem"}),e.jsxs("span",{className:"ml-1",children:["Born ",w(s.birthday,y("universal"))]})]}),e.jsxs(q,{variant:"bordered",className:"mt-1",children:[e.jsx(G,{width:"1rem",height:"1rem"}),e.jsxs("span",{className:"ml-1",children:["Joined ",w(s.createdAt,y("joinDay"))]})]})]})]})})]})};export{be as default};
