import{r as i,a$ as S}from"./index-Dq1-S-Sq.js";import{u as k}from"./index-DI5j7JYK.js";function F(a={}){const{loading:e,src:t,srcSet:r,onLoad:s,onError:n,crossOrigin:c,sizes:u,ignoreFallback:g}=a,[d,m]=i.useState("pending");i.useEffect(()=>{m(t?"loading":"pending")},[t]);const l=i.useRef(),b=i.useCallback(()=>{if(!t)return;f();const o=new Image;o.src=t,c&&(o.crossOrigin=c),r&&(o.srcset=r),u&&(o.sizes=u),e&&(o.loading=e),o.onload=v=>{f(),m("loaded"),s==null||s(v)},o.onerror=v=>{f(),m("failed"),n==null||n(v)},l.current=o},[t,c,r,u,s,n,e]),f=()=>{l.current&&(l.current.onload=null,l.current.onerror=null,l.current=null)};return k(()=>{if(!g)return d==="loading"&&b(),()=>{f()}},[d,b,g]),g?"loaded":d}var h=(a=>(a.Avatar="/file/avatar",a.Custom="",a))(h||{});const O=(a="/file/avatar",e)=>{const t=new FormData;return t.append("file",e),S("POST",a,{file:!0,data:t})},C=2,w=new Map,E=(()=>{const a={"/file/avatar":0,"":0};return async(e="/file/avatar",t)=>{for(;a[e]>=C;)await new Promise(u=>setTimeout(u,50));a[e]++;let r;switch(e){case"/file/avatar":r=`/file/avatar/${t}`;break;case"":r=t;break}const s=w.get(r);if(s)return a[e]--,s;const n=await S("GET",r,{mustJSON:!1,local:e===""});if(n.statusCode!==200)throw a[e]--,"failed to fetch file";const c=URL.createObjectURL(n.blob);return w.set(r,c),a[e]--,c}})(),L="/images/default-avatar.jpg",R="/images/default-background.png",p="/images/backtrace.svg",U="/images/logo.png",j=({src:a,backtrace:e,custom:t})=>{const[r,s]=i.useState(e||p);return i.useEffect(()=>{E(a===L||t?h.Custom:h.Avatar,a).then(n=>{s(n)}).catch(()=>{s(e||L)})}),r};export{j as A,L as D,U as L,O as U,h as a,R as b,F as u};
