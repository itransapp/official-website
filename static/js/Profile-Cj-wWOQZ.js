import{n as e,r as m,O as T,P as q,U as N,C as g,B as k,Q as O,S as R,T as b,V as y}from"./index-wNxkLrUB.js";import{t as S,R as M}from"./Report-BU-Unhx6.js";import{o as C}from"./index.module-D8UYGA2S.js";import{m as U,a as Z,b as _,c as B,d as P}from"./chunk-CQCLQUUP-BW99jCOc.js";import{i as L}from"./chunk-NNXNFLWG-B26fCzaU.js";import{i as D}from"./chunk-UWUNWEEL-BiAKDzvU.js";import{A as E}from"./Avatar-D8bcB3jQ.js";import{U as F,a as $,b as H}from"./index-BnYZiPK4.js";import{d as z,b as A,c as I,m as j}from"./chunk-3YEK3JGC-wEjpkDbB.js";import{c as v}from"./chunk-YOZJQNDF-DkxMUoj-.js";import"./import-VwD6fEqS.js";import"./index-C6zaZG5k.js";import"./scrollIntoView-K6ewTw8a.js";import"./chunk-OZXMJY32-CEsl3J-q.js";import"./chunk-44JHHBS2-B78DHzAo.js";const V=a=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...a,children:e.jsx("path",{d:"M480-480q33 0 56.5-23.5T560-560q0-33-23.5-56.5T480-640q-33 0-56.5 23.5T400-560q0 33 23.5 56.5T480-480Zm0 294q122-112 181-203.5T720-552q0-109-69.5-178.5T480-800q-101 0-170.5 69.5T240-552q0 71 59 162.5T480-186Zm0 106Q319-217 239.5-334.5T160-552q0-150 96.5-239T480-880q127 0 223.5 89T800-552q0 100-79.5 217.5T480-80Zm0-480Z"})}),Q=a=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...a,children:e.jsx("path",{d:"m80-80 200-560 360 360L80-80Zm132-132 282-100-182-182-100 282Zm370-246-42-42 224-224q32-32 77-32t77 32l24 24-42 42-24-24q-14-14-35-14t-35 14L582-458ZM422-618l-42-42 24-24q14-14 14-34t-14-34l-26-26 42-42 26 26q32 32 32 76t-32 76l-24 24Zm80 80-42-42 144-144q14-14 14-35t-14-35l-64-64 42-42 64 64q32 32 32 77t-32 77L502-538Zm160 160-42-42 64-64q32-32 77-32t77 32l64 64-42 42-64-64q-14-14-35-14t-35 14l-64 64ZM212-212Z"})}),G=a=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...a,children:e.jsx("path",{d:"M200-80q-33 0-56.5-23.5T120-160v-560q0-33 23.5-56.5T200-800h40v-80h80v80h320v-80h80v80h40q33 0 56.5 23.5T840-720v560q0 33-23.5 56.5T760-80H200Zm0-80h560v-400H200v400Zm0-480h560v-80H200v80Zm0 0v-80 80Zm280 240q-17 0-28.5-11.5T440-440q0-17 11.5-28.5T480-480q17 0 28.5 11.5T520-440q0 17-11.5 28.5T480-400Zm-160 0q-17 0-28.5-11.5T280-440q0-17 11.5-28.5T320-480q17 0 28.5 11.5T360-440q0 17-11.5 28.5T320-400Zm320 0q-17 0-28.5-11.5T600-440q0-17 11.5-28.5T640-480q17 0 28.5 11.5T680-440q0 17-11.5 28.5T640-400ZM480-240q-17 0-28.5-11.5T440-280q0-17 11.5-28.5T480-320q17 0 28.5 11.5T520-280q0 17-11.5 28.5T480-240Zm-160 0q-17 0-28.5-11.5T280-280q0-17 11.5-28.5T320-320q17 0 28.5 11.5T360-280q0 17-11.5 28.5T320-240Zm320 0q-17 0-28.5-11.5T600-280q0-17 11.5-28.5T640-320q17 0 28.5 11.5T680-280q0 17-11.5 28.5T640-240Z"})}),J=({isOpen:a,onOpenChange:f,username:t,onUsernameChange:c})=>{const[i,u]=m.useState(t),[p,x]=m.useState(!1),[l]=C(i,1e3),{show:o}=T();return m.useEffect(()=>{if(l&&l!==t){if(!q(l)){x(!1);return}N({username:l,checkOnly:!0}).then(d=>{var s,r;if(!((s=d.data)!=null&&s.status)){x(!1),d.statusCode===200?o({message:"username already used"}):o({message:(r=d.data)==null?void 0:r.msg});return}x(!0)}).catch(d=>{o({message:d})})}else x(!1)},[l]),m.useEffect(()=>{u(t)},[t]),e.jsx(U,{isOpen:a,onOpenChange:d=>{u(t),f(d)},children:e.jsx(Z,{children:d=>e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"flex flex-col gap-1",children:"Change your username"}),e.jsx(B,{children:e.jsx(L,{className:"font-medium",placeholder:"iTrans unique username",startContent:e.jsx("p",{className:"font-bold",children:"@"}),value:i,onValueChange:s=>{u(s)},errorMessage:q(i)?"":"invalid username"})}),e.jsxs(P,{children:[e.jsx(g,{color:"danger",variant:"light",onPress:d,children:"Cancel"}),e.jsx(g,{color:"primary",isDisabled:!p||i===t||!q(i),onPress:()=>{c(i),d()},children:"Submit"})]})]})})})},K=a=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...a,children:e.jsx("path",{d:"M480-260q75 0 127.5-52.5T660-440q0-75-52.5-127.5T480-620q-75 0-127.5 52.5T300-440q0 75 52.5 127.5T480-260Zm0-80q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29ZM160-120q-33 0-56.5-23.5T80-200v-480q0-33 23.5-56.5T160-760h126l74-80h240l74 80h126q33 0 56.5 23.5T880-680v480q0 33-23.5 56.5T800-120H160Zm0-80h640v-480H638l-73-80H395l-73 80H160v480Zm320-240Z"})}),W=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],w=(a,f=2)=>{if(a==0)return"0 Bytes";const t=1024,c=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,c)).toFixed(f))+" "+W[c]},Y=({maxUploadSize:a=3<<20,onSetHook:f,onUpload:t,onCancel:c})=>{const[i,u]=m.useState(null),[p,x]=m.useState(""),[l,o]=m.useState(!1),d=m.useRef(null),{show:s}=T(),r=()=>{URL.revokeObjectURL(p),o(!1),i&&(t(i),u(null))};return m.useEffect(()=>{i&&(x(URL.createObjectURL(i)),o(!0))},[i]),m.useEffect(()=>{f(()=>()=>{var n;(n=d.current)==null||n.click()})},[f,d.current]),e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",id:"photo-uploader",ref:d,className:"hidden",accept:"image/png, image/jpeg, image/gif, image/webp",onChange:n=>{if(n.target.files&&n.target.files.length===1){const h=n.target.files.item(0);if(!h)return;if(h.size>a){s({message:`current file too large (${w(h.size)}), max: ${w(a)}`});return}u(h)}}}),e.jsx(U,{isOpen:l,onOpenChange:n=>{URL.revokeObjectURL(p),o(n),!n&&c&&c()},children:e.jsx(Z,{children:n=>e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"flex flex-col gap-1",children:"Confirm the image you are about to upload"}),e.jsx(B,{className:"flex items-center justify-center",children:e.jsx(D,{style:{maxWidth:"256px",maxHeight:"256px"},src:p,alt:"Preview image"})}),e.jsxs(P,{children:[e.jsx(g,{color:"danger",variant:"light",onPress:()=>{n(),URL.revokeObjectURL(p),c&&c(),u(null)},children:"Cancel"}),e.jsx(g,{color:"primary",onPress:r,children:"Upload"})]})]})})})]})},fe=()=>{const[a,f]=m.useState({type:"self"}),[t,c]=m.useState({firstname:"",lastname:"System",createdAt:new Date}),[i,u]=m.useState({isOpen:!1,username:""}),[p,x]=m.useState(()=>{}),{profile:l}=k(),{show:o}=T(),d=O();return m.useEffect(()=>{const s=d.id;if(!s)return;if(q(s)){f({type:"username",username:s});return}const r=S(s);if(r){f({type:"userID",userID:r});return}},[]),m.useEffect(()=>{switch(a.type){case"username":N({username:a.username}).then(s=>{var r,n,h;if(!((r=s.data)!=null&&r.data)||!((n=s.data)!=null&&n.status)){o({message:(h=s.data)==null?void 0:h.msg});return}c({...s.data.data})}).catch(s=>{o({message:s})});break;case"userID":o({message:"unsupported query method"});break;case"self":if(!l){o({message:"failed to get user profile"});return}c({...l});break}},[a]),e.jsxs("div",{children:[e.jsx(J,{isOpen:i.isOpen,onOpenChange:s=>{u({...i,isOpen:s})},username:t.username,onUsernameChange:s=>{u({...i,username:s}),s&&R({username:s}).then(r=>{var n,h;if(!((n=r.data)!=null&&n.status)){o({message:(h=r.data)==null?void 0:h.msg});return}c({...t,username:s})}).catch(r=>{o({message:r})})}}),e.jsx(Y,{maxUploadSize:10<<20,onSetHook:x,onUpload:s=>{console.log("on uploader",s),F($.Avatar,s).then(r=>{var n,h;if(!((n=r.data)!=null&&n.status)){o({message:`failed to upload avatar, cause: ${(h=r.data)==null?void 0:h.msg}`});return}}).catch(r=>{o({message:`failed to upload avatar, cause: ${r}`})})}}),e.jsx("div",{style:{backgroundSize:"cover",backgroundImage:`url('${t.background?t.background:H}')`,backgroundPosition:"center",backgroundRepeat:"no-repeat",height:"200px"},children:e.jsxs(z,{size:"sm",placement:"right-end",children:[e.jsx(A,{children:e.jsx(E,{style:{position:"relative",zIndex:10,top:"100%",left:"5%",transform:"translate(-5%, -50%)",width:"20vh",height:"auto",userSelect:"none"},alt:t.firstname,src:(l==null?void 0:l.id.toString())||(l==null?void 0:l.username),name:t.firstname,showFallback:!0})}),e.jsxs(I,{"aria-label":"avatar action",title:"Actions",children:[a.type==="self"&&t?e.jsx(j,{startContent:e.jsx(K,{width:"1.25rem",height:"1.25rem"}),onPress:p,textValue:"Upload photo",children:e.jsx("span",{className:"font-medium",children:"Upload photo"})},"select-new-photo"):e.jsx(j,{className:"hidden",textValue:"hidden item",isReadOnly:!0}),a.type!=="self"&&t?e.jsx(j,{color:"danger",className:"text-danger",startContent:e.jsx(M,{width:"1.25rem",height:"1.25rem"}),textValue:"Report this user",children:e.jsx("span",{className:"font-medium",children:"Report this user"})},"report-this-user"):e.jsx(j,{className:"hidden",textValue:"hidden item",isReadOnly:!0})]})]})}),e.jsx(g,{style:{position:"relative",zIndex:10,top:"100%",left:"95%",transform:"translate(-95%, 50%)"},color:"primary",variant:"bordered",radius:"lg",children:"Edit your profile"}),e.jsx("div",{className:"flex items-center mt-16 dark:bg-black",style:{marginTop:"10vh",width:"90%",transform:"translate(5%, 0%)"},children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-4xl font-bold",children:[t.firstname," ",t.lastname,e.jsxs("span",{className:`${a.type!=="self"?"hidden":""} ml-3 font-normal text-small text-gray-500 dark:text-gray-400 hover:underline`,onClick:()=>u({...i,isOpen:!0}),children:["@",t.username||"Set username"]})]}),e.jsxs("p",{className:`${t.bio?"":"hidden"} font-medium`,children:["Bio:",e.jsx("span",{className:"ml-1 font-normal text-gray-600 dark:text-gray-300",children:t.bio})]}),e.jsxs("div",{className:"mt-5 whitespace-pre-wrap inline",children:[e.jsxs(v,{variant:"bordered",className:`${t.location?"mr-2":"hidden"}`,children:[e.jsx(V,{width:"1rem",height:"1rem"}),e.jsx("span",{className:"ml-1",children:t.location})]}),e.jsxs(v,{variant:"bordered",className:`${t.birthday?"mt-1 mr-2":"hidden"}`,children:[e.jsx(Q,{width:"1rem",height:"1rem"}),e.jsxs("span",{className:"ml-1",children:["Born ",b(t.birthday,y("universal"))]})]}),e.jsxs(v,{variant:"bordered",className:"mt-1",children:[e.jsx(G,{width:"1rem",height:"1rem"}),e.jsxs("span",{className:"ml-1",children:["Joined ",b(t.createdAt,y("joinDay"))]})]})]})]})})]})};export{fe as default};
