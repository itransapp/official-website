import{n as e,r as u,C as g,z as l,aD as P,M as B,Q as I,O as E,B as L,aH as U,aI as W,aJ as K,aK as G}from"./index-BdIS0KBP.js";import{m as D,O as J}from"./Open-Yj-tt6SY.js";import{f as Q,t as V}from"./text-B64jcAFk.js";import{c as R,e as S,f as F,d as X,a as Y,b as ee,m as w}from"./chunk-3YEK3JGC-6REcX8dh.js";import{F as te,u as se,P as ae}from"./Preview-BczAqoh5.js";import{A as re}from"./Avatar-CFJ8CsYz.js";import{R as ie,t as le}from"./Report-ZW1jAcbs.js";import{S as ne}from"./Share-IV96zOAR.js";import{c as Z}from"./chunk-JHUBASYZ-BTbEv0Wt.js";import{c as O,a as $}from"./chunk-J333S7JQ-DBNbyS2J.js";import{c as k}from"./chunk-H4VOEXHF-BukCfG2o.js";import{d as _}from"./chunk-44JHHBS2-CqpzyKM9.js";import{R as oe}from"./index-mMhEPtTu.js";import{m as de,a as me,b as ce,c as he,d as ue}from"./chunk-CQCLQUUP-Cg0MuJbr.js";import{c as fe}from"./chunk-YOZJQNDF-fLTGgFBL.js";import{l as xe}from"./chunk-4HJHOVVR-CMipdDMN.js";import"./import-CwEskJzT.js";import"./index-CDYrjvMm.js";import"./scrollIntoView-DkxkJpCI.js";import"./chunk-CIZQCQPA-BSMQi_ai.js";import"./index-PHN-72xn.js";import"./context-D-DkIFfH.js";import"./useSelectableItem-CzgQiDYt.js";import"./chunk-BOCK7NOT-Ce0wveLk.js";import"./chunk-OZXMJY32-Dh6HssZ3.js";import"./index-Bm7d3FEA.js";import"./chunk-QXREVWCS-PXHS518L.js";const pe=n=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...n,children:e.jsx("path",{d:"M480-480Zm0 400q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q43 0 83 8.5t77 24.5v90q-35-20-75.5-31.5T480-800q-133 0-226.5 93.5T160-480q0 133 93.5 226.5T480-160q133 0 226.5-93.5T800-480q0-32-6.5-62T776-600h86q9 29 13.5 58.5T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm320-600v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80ZM620-520q25 0 42.5-17.5T680-580q0-25-17.5-42.5T620-640q-25 0-42.5 17.5T560-580q0 25 17.5 42.5T620-520Zm-280 0q25 0 42.5-17.5T400-580q0-25-17.5-42.5T340-640q-25 0-42.5 17.5T280-580q0 25 17.5 42.5T340-520Zm140 260q68 0 123.5-38.5T684-400H276q25 63 80.5 101.5T480-260Z"})}),ge=["👍","👎","😁","🎉","❤️","👀","💩"],je=({username:n,reactions:j,onReactions:i})=>{const[f,o]=u.useState(()=>{const a={};for(let s=0;s<j.length;s++)a[s]=!1;return a});return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(R,{placement:"top-start",backdrop:"opaque",radius:"sm",children:[e.jsx(S,{children:e.jsx(g,{className:"text-lg",variant:"flat",radius:"full",size:"sm",isIconOnly:!0,children:e.jsx(pe,{})})}),e.jsx(F,{children:e.jsx("div",{className:"flex gap-1",children:ge.map((a,s)=>e.jsx(g,{className:"inline-block text-lg",isIconOnly:!0,size:"sm",variant:"light",children:a},s))})})]}),j.map((a,s)=>{const p=a.users.indexOf(n)!==-1;return e.jsxs(R,{isOpen:f[s],onOpenChange:d=>o({...f,[s]:d}),showArrow:!0,radius:"sm",children:[e.jsx(S,{children:e.jsxs(g,{className:"text-md",variant:p?"solid":"bordered",color:p?"primary":"default",radius:"full",size:"sm",onMouseEnter:()=>o({...f,[s]:!0}),onMouseLeave:()=>o({...f,[s]:!1}),onClick:()=>{o({...f,[s]:!1}),i&&i(p,a.emoji)},children:[a.emoji," ",a.users.length]})}),e.jsx(F,{className:"text-gray-500 dark:text-gray-400",style:{maxWidth:"300px"},children:Q(a.emoji,a.users)})]},s)})]})},ve=n=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...n,children:e.jsx("path",{d:"M240-400q-33 0-56.5-23.5T160-480q0-33 23.5-56.5T240-560q33 0 56.5 23.5T320-480q0 33-23.5 56.5T240-400Zm240 0q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm240 0q-33 0-56.5-23.5T640-480q0-33 23.5-56.5T720-560q33 0 56.5 23.5T800-480q0 33-23.5 56.5T720-400Z"})}),be=n=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...n,children:e.jsx("path",{d:"M780-200v-156q0-60-39-99t-99-39H236l163 163-43 43-236-236 236-236 43 43-163 163h406q85 0 141.5 56.5T840-356v156h-60Z"})}),Ne=n=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...n,children:e.jsx("path",{d:"M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"})}),A=({cid:n,id:j,firstname:i,lastname:f,username:o,content:a,createdAt:s,allowedDelete:p,followed:d,showFollow:b,onFollow:h,onReply:T,onDelete:m,reactions:c})=>{const[x,N]=u.useState(!1);return e.jsxs(k,{fullWidth:!0,classNames:{base:"rounded-r-none md:rounded-r-lg rounded-l-none md:rounded-l-lg"},children:[e.jsxs(O,{className:"justify-between",children:[e.jsxs("div",{className:"flex gap-5",children:[e.jsx(re,{radius:"full",size:"md",src:`@${o}`}),e.jsxs("div",{className:"flex flex-col gap-1 items-start justify-center",children:[e.jsxs("h4",{className:"text-medium font-semibold leading-none text-default-600",children:[i," ",f]}),e.jsx(e.Fragment,{children:o?e.jsxs("h5",{className:"text-small tracking-tight text-default-400",children:["@",o]}):null})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:`font-medium ${b?"":"hidden"} ${d?"bg-transparent text-foreground border-default-200":""}`,color:"primary",radius:"full",size:"sm",variant:d?"bordered":"solid",onPress:h,isDisabled:!0,children:d?"Unfollow":"Follow"}),e.jsxs(X,{size:"sm",children:[e.jsx(Y,{children:e.jsx(g,{size:"sm",isIconOnly:!0,variant:"light",children:e.jsx(ve,{width:"1.25rem",height:"1.25rem"})})}),e.jsxs(ee,{"aria-label":"comment actions",disabledKeys:x?["share"]:void 0,children:[e.jsxs(D,{title:l("actions"),showDivider:!0,children:[e.jsx(w,{startContent:e.jsx(ne,{width:"1.25rem",height:"1.25rem"}),onPress:()=>{navigator.clipboard.writeText(`https://itrans.app/chalkboard/${n}?${new URLSearchParams({mid:j.toString(16)})}`).then(()=>{N(!0),setTimeout(()=>{N(!1)},1500)})},children:x?l("pages.chalkboard.details.copy_success"):l("pages.chalkboard.details.copy_link")},"share"),e.jsx(w,{startContent:e.jsx(be,{width:"1.25rem",height:"1.25rem"}),onPress:T,children:l("reply")},"reply"),e.jsx(w,{startContent:e.jsx(Ne,{width:"1.25rem",height:"1.25rem"}),onPress:m,className:`${p?"":"hidden"}`,children:l("delete")},"delete")]}),e.jsx(D,{title:l("feedback"),children:e.jsx(w,{startContent:e.jsx(ie,{width:"1.25rem",height:"1.25rem"}),color:"danger",className:"text-danger",children:l("report_content")},"report")})]})]})]})]}),e.jsx(_,{}),e.jsxs($,{children:[e.jsx(te,{className:"pt-2 pb-2 pr-1 pl-1",children:decodeURIComponent(a)}),c!=null&&c.reactions?e.jsx("div",{className:"mt-3",children:e.jsx(je,{username:c.username,reactions:c.reactions,onReactions:c.onReactions})}):null]}),e.jsx(_,{}),e.jsx(Z,{className:"gap-3",children:e.jsx("span",{className:"text-small text-gray-500",children:l("pages.chalkboard.details.commented_on",{created_at:P(s)})})})]})},we={close:!1,id:7164271119128596480n,author:BigInt(1),username:"Z-Siqi",comments:1,title:"新加坡 Mount Elizabeth 医院的 Alex Fok 医生可以给16岁开HRT治疗",contentPreview:"Hello",labels:[{name:"内容",color:"#4feeff"},{name:"HRT",color:"#0be01f"}],createdAt:new Date,updatedAt:new Date},Qe=()=>{const n=B(),j=I(),{show:i}=E(),{isOpen:f,onOpenChange:o}=se(),{profile:a}=L(),[s,p]=u.useState({author:0n,close:!1,comments:0,content:"",createdAt:new Date,firstname:"",labels:[],lastname:"",reactions:[],title:"",updatedAt:new Date,username:""}),[d,b]=u.useState([]),[h,T]=u.useState(0n),[m,c]=u.useState({description:"",recaptcha:null}),[x,N]=u.useState({total:0,offset:0,limit:10,beforeOffset:0}),M=()=>{W({offset:x.offset,limit:x.limit,cid:h}).then(t=>{var r;if(!t.data){i({message:"Failed to fetch chalkboard comments"});return}if(!t.data.status||!t.data.data){i({message:(r=t.data)==null?void 0:r.msg});return}t.data.data.total!==0&&(b([...d,...t.data.data.list]),N({...x,total:t.data.data.total,beforeOffset:x.offset}))}).catch(t=>i({message:t}))},z=()=>{a&&(o(),K({cid:h,content:m.description,ticket:m.recaptcha||""}).then(t=>{var r,v;if(!((r=t.data)!=null&&r.status)){i({message:(v=t.data)==null?void 0:v.msg});return}b([...d,{id:t.data.data||0n,author:a.id,username:a.username,firstname:a.firstname,lastname:a.lastname,content:m.description,reactions:[],createdAt:new Date,updatedAt:new Date}]),c({description:"",recaptcha:null,reply:void 0})}).catch(t=>i({message:t})))},H=(t,r)=>{G({cid:h,tid:r}).then(v=>{var C,y;if(!((C=v.data)!=null&&C.status)){i({message:(y=v.data)==null?void 0:y.msg});return}b([...d.slice(0,t),...d.slice(t+1,d.length)]),p({...s,comments:s.comments-1})}).catch(v=>i({message:v}))},q=u.useCallback(t=>{c(r=>({...r,description:t}))},[]);return u.useEffect(()=>{const t=j.id;if(!t){n("/chalkboard");return}const r=le(t);if(!r){n("/chalkboard");return}T(r)},[j]),u.useEffect(()=>{h&&(s.title||U({id:h}).then(t=>{if(!t.data){i({message:"Failed to fetch chalkboard details"});return}if(!t.data.status||!t.data.data){i({message:t.data.msg});return}p(t.data.data)}).catch(t=>i({message:t})),M())},[h,x.limit,x.offset]),e.jsxs("div",{className:"md:w-10/12 ml-auto mr-auto mt-8",children:[e.jsx(de,{isOpen:f,onOpenChange:o,children:e.jsx(me,{children:t=>e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:l("captcha")}),e.jsx(he,{className:"flex items-center justify-center",children:e.jsx(oe,{onValueChange:r=>c({...m,recaptcha:r})})}),e.jsxs(ue,{children:[e.jsx(g,{color:"danger",variant:"light",onPress:t,children:l("cancel")}),e.jsx(g,{color:"primary",onPress:z,isDisabled:!m.recaptcha,children:l("submit")})]})]})})}),e.jsxs("div",{className:"block w-full pl-3 pr-3 md:pl-0 md:pr-0",children:[e.jsxs("h1",{className:"text-3xl",children:[e.jsx("bdi",{className:"break-words tracking-tight",children:s.title}),e.jsx("span",{className:"text-2xl text-gray-500",children:` #${h.toString(16).slice(0,8)}`})]}),e.jsx("div",{className:"flex mt-2 items-center",children:e.jsxs(e.Fragment,{children:[e.jsx(fe,{startContent:e.jsx(J,{height:"2em",width:"2em",style:{marginTop:"0.5rem",fill:"#FFFFFF"}}),className:"text-white pl-2",classNames:{content:"pl-0"},variant:"solid",color:"success",children:e.jsx("p",{className:"text-large font-medium",children:l("pages.chalkboard.open")})}),e.jsxs("div",{className:"inline ml-2 text-gray-500 text-small",children:[e.jsx(xe,{size:"sm",href:`/user/${s.username||s.author.toString()}`,className:"mr-1 font-medium text-medium text-gray-500",children:s.username?`@${s.username}`:`@${s.author.toString(16).slice(0,8)}`}),l("pages.chalkboard.details.hint_open",{created_at:P(we.createdAt),comment:s.comments})]})]})})]}),e.jsx(_,{className:"mt-5 mb-5"}),e.jsx("div",{className:"flex gap-10",children:e.jsxs("div",{className:"w-full space-y-4",children:[e.jsx(A,{cid:h,id:0n,firstname:s.firstname,lastname:s.lastname,username:s.username||"",content:s.content,createdAt:s.createdAt,reactions:{username:"",reactions:s.reactions||[]},allowedDelete:!1,onDelete:()=>{},onReply:()=>c({...m,reply:void 0})}),d.map((t,r)=>e.jsx(A,{...t,username:t.username||"",cid:h,onReply:()=>{c({...m,reply:t.id}),q(`${V(t.content)}

${m.description}`)},allowedDelete:(a==null?void 0:a.id.toString())===t.author.toString(),onFollow:()=>{},onDelete:()=>H(r,t.id),reactions:{username:"",reactions:t.reactions||[]}},r)),a?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mt-5 mb-5"}),e.jsxs(k,{fullWidth:!0,children:[e.jsx(O,{className:"pb-0",children:e.jsx("span",{className:"font-medium",children:l("pages.chalkboard.details.add_comment")})}),e.jsx($,{className:"pb-1",children:e.jsx(ae,{className:"w-full max-h-screen",color:"primary",content:m.description,setContent:q,classNames:{panel:"px-0"},minRows:5,maxRows:15})}),e.jsxs(Z,{className:"pt-1 flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm font-medium text-transgender",children:["Remember, that your Comment should adhere to the"," ",e.jsx("p",{className:"font-bold inline",children:"iTrans Community Content Guidelines"})]})}),e.jsx(g,{className:"font-medium",color:"primary",isDisabled:!m.description,onPress:o,children:l("submit")})]})]})]}):null]})})]})};export{Qe as default};
