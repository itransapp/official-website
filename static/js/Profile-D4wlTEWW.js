import{l as e,r as d,L as T,M as q,U as N,z as g,y as B,N as O,O as P}from"./index-CWvHVWpG.js";import{A as S,f as b,g as y}from"./Avatar-ChCZUKqf.js";import{t as M,R as C}from"./Report-DlBYdWH6.js";import{o as E}from"./index.module-vU__u63E.js";import{m as U,a as Z,b as _,c as R,d as k}from"./chunk-II5OMS4Q-DYqDvvDQ.js";import{i as L}from"./chunk-TC4QW7OA-DFoL5MVH.js";import{i as D}from"./chunk-OFGZKCFR-DPuORlet.js";import{U as F,a as $,b as A,D as z}from"./index-C3t5u28Y.js";import{d as H,b as I,c as V,m as j}from"./chunk-L6QJ42W6-Cch2fe3k.js";import{c as v}from"./chunk-OFH6WYRQ-Bc4py5Vv.js";import"./import--9aNNLJH.js";import"./Combination-CXI9X5xf.js";import"./chunk-LY2CD73K-Dn7tJKMO.js";import"./chunk-CAFRINWI-CcU5yOMx.js";import"./index-QsUcXbWp.js";import"./chunk-44JHHBS2-DYrg1EOX.js";const Y=a=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...a,children:e.jsx("path",{d:"M480-480q33 0 56.5-23.5T560-560q0-33-23.5-56.5T480-640q-33 0-56.5 23.5T400-560q0 33 23.5 56.5T480-480Zm0 294q122-112 181-203.5T720-552q0-109-69.5-178.5T480-800q-101 0-170.5 69.5T240-552q0 71 59 162.5T480-186Zm0 106Q319-217 239.5-334.5T160-552q0-150 96.5-239T480-880q127 0 223.5 89T800-552q0 100-79.5 217.5T480-80Zm0-480Z"})}),G=a=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...a,children:e.jsx("path",{d:"m80-80 200-560 360 360L80-80Zm132-132 282-100-182-182-100 282Zm370-246-42-42 224-224q32-32 77-32t77 32l24 24-42 42-24-24q-14-14-35-14t-35 14L582-458ZM422-618l-42-42 24-24q14-14 14-34t-14-34l-26-26 42-42 26 26q32 32 32 76t-32 76l-24 24Zm80 80-42-42 144-144q14-14 14-35t-14-35l-64-64 42-42 64 64q32 32 32 77t-32 77L502-538Zm160 160-42-42 64-64q32-32 77-32t77 32l64 64-42 42-64-64q-14-14-35-14t-35 14l-64 64ZM212-212Z"})}),J=a=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...a,children:e.jsx("path",{d:"M200-80q-33 0-56.5-23.5T120-160v-560q0-33 23.5-56.5T200-800h40v-80h80v80h320v-80h80v80h40q33 0 56.5 23.5T840-720v560q0 33-23.5 56.5T760-80H200Zm0-80h560v-400H200v400Zm0-480h560v-80H200v80Zm0 0v-80 80Zm280 240q-17 0-28.5-11.5T440-440q0-17 11.5-28.5T480-480q17 0 28.5 11.5T520-440q0 17-11.5 28.5T480-400Zm-160 0q-17 0-28.5-11.5T280-440q0-17 11.5-28.5T320-480q17 0 28.5 11.5T360-440q0 17-11.5 28.5T320-400Zm320 0q-17 0-28.5-11.5T600-440q0-17 11.5-28.5T640-480q17 0 28.5 11.5T680-440q0 17-11.5 28.5T640-400ZM480-240q-17 0-28.5-11.5T440-280q0-17 11.5-28.5T480-320q17 0 28.5 11.5T520-280q0 17-11.5 28.5T480-240Zm-160 0q-17 0-28.5-11.5T280-280q0-17 11.5-28.5T320-320q17 0 28.5 11.5T360-280q0 17-11.5 28.5T320-240Zm320 0q-17 0-28.5-11.5T600-280q0-17 11.5-28.5T640-320q17 0 28.5 11.5T680-280q0 17-11.5 28.5T640-240Z"})}),K=({isOpen:a,onOpenChange:f,username:t,onUsernameChange:m})=>{const[i,u]=d.useState(t),[p,x]=d.useState(!1),[c]=E(i,1e3),{show:l}=T();return d.useEffect(()=>{if(c&&c!==t){if(!q(c)){x(!1);return}N({username:c,checkOnly:!0}).then(o=>{var s,r;if(!((s=o.data)!=null&&s.status)){x(!1),o.statusCode===200?l({message:"username already used"}):l({message:(r=o.data)==null?void 0:r.msg});return}x(!0)}).catch(o=>{l({message:o})})}else x(!1)},[c]),d.useEffect(()=>{u(t)},[t]),e.jsx(U,{isOpen:a,onOpenChange:o=>{u(t),f(o)},children:e.jsx(Z,{children:o=>e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"flex flex-col gap-1",children:"Change your username"}),e.jsx(R,{children:e.jsx(L,{className:"font-medium",placeholder:"iTrans unique username",startContent:e.jsx("p",{className:"font-bold",children:"@"}),value:i,onValueChange:s=>{u(s)},errorMessage:q(i)?"":"invalid username"})}),e.jsxs(k,{children:[e.jsx(g,{color:"danger",variant:"light",onPress:o,children:"Cancel"}),e.jsx(g,{color:"primary",isDisabled:!p||i===t||!q(i),onPress:()=>{m(i),o()},children:"Submit"})]})]})})})},Q=a=>e.jsx("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 -960 960 960",width:"1em",className:"inline-block overflow-visible align-text-bottom fill-current",...a,children:e.jsx("path",{d:"M480-260q75 0 127.5-52.5T660-440q0-75-52.5-127.5T480-620q-75 0-127.5 52.5T300-440q0 75 52.5 127.5T480-260Zm0-80q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29ZM160-120q-33 0-56.5-23.5T80-200v-480q0-33 23.5-56.5T160-760h126l74-80h240l74 80h126q33 0 56.5 23.5T880-680v480q0 33-23.5 56.5T800-120H160Zm0-80h640v-480H638l-73-80H395l-73 80H160v480Zm320-240Z"})}),W=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],w=(a,f=2)=>{if(a==0)return"0 Bytes";const t=1024,m=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,m)).toFixed(f))+" "+W[m]},X=({maxUploadSize:a=3<<20,onSetHook:f,onUpload:t,onCancel:m})=>{const[i,u]=d.useState(null),[p,x]=d.useState(""),[c,l]=d.useState(!1),o=d.useRef(null),{show:s}=T(),r=()=>{URL.revokeObjectURL(p),l(!1),i&&(t(i),u(null))};return d.useEffect(()=>{i&&(x(URL.createObjectURL(i)),l(!0))},[i]),d.useEffect(()=>{f(()=>()=>{var n;(n=o.current)==null||n.click()})},[f,o.current]),e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",id:"photo-uploader",ref:o,className:"hidden",accept:"image/png, image/jpeg, image/gif, image/webp",onChange:n=>{if(n.target.files&&n.target.files.length===1){const h=n.target.files.item(0);if(!h)return;if(h.size>a){s({message:`current file too large (${w(h.size)}), max: ${w(a)}`});return}u(h)}}}),e.jsx(U,{isOpen:c,onOpenChange:n=>{URL.revokeObjectURL(p),l(n),!n&&m&&m()},children:e.jsx(Z,{children:n=>e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"flex flex-col gap-1",children:"Confirm the image you are about to upload"}),e.jsx(R,{className:"flex items-center justify-center",children:e.jsx(D,{style:{maxWidth:"256px",maxHeight:"256px"},src:p,alt:"Preview image"})}),e.jsxs(k,{children:[e.jsx(g,{color:"danger",variant:"light",onPress:()=>{n(),URL.revokeObjectURL(p),m&&m(),u(null)},children:"Cancel"}),e.jsx(g,{color:"primary",onPress:r,children:"Upload"})]})]})})})]})},xe=()=>{const[a,f]=d.useState({type:"self"}),[t,m]=d.useState({firstname:"",lastname:"System",createdAt:new Date}),[i,u]=d.useState({isOpen:!1,username:""}),[p,x]=d.useState(()=>{}),{profile:c}=B(),{show:l}=T(),o=O();return d.useEffect(()=>{const s=o.id;if(!s)return;if(q(s)){f({type:"username",username:s});return}const r=M(s);if(r){f({type:"userID",userID:r});return}},[]),d.useEffect(()=>{switch(a.type){case"username":N({username:a.username}).then(s=>{var r,n,h;if(!((r=s.data)!=null&&r.data)||!((n=s.data)!=null&&n.status)){l({message:(h=s.data)==null?void 0:h.msg});return}m({...s.data.data})}).catch(s=>{l({message:s})});break;case"userID":l({message:"unsupported query method"});break;case"self":if(!c){l({message:"failed to get user profile"});return}m({...c});break}},[a]),e.jsxs("div",{children:[e.jsx(K,{isOpen:i.isOpen,onOpenChange:s=>{u({...i,isOpen:s})},username:t.username,onUsernameChange:s=>{u({...i,username:s}),s&&P({username:s}).then(r=>{var n,h;if(!((n=r.data)!=null&&n.status)){l({message:(h=r.data)==null?void 0:h.msg});return}m({...t,username:s})}).catch(r=>{l({message:r})})}}),e.jsx(X,{maxUploadSize:10<<20,onSetHook:x,onUpload:s=>{console.log("on uploader",s),F($.Avatar,s).then(r=>{var n,h;if(!((n=r.data)!=null&&n.status)){l({message:`failed to upload avatar, cause: ${(h=r.data)==null?void 0:h.msg}`});return}}).catch(r=>{l({message:`failed to upload avatar, cause: ${r}`})})}}),e.jsx("div",{style:{backgroundSize:"cover",backgroundImage:`url('${t.background?t.background:A}')`,backgroundPosition:"center",backgroundRepeat:"no-repeat",height:"200px"},children:e.jsxs(H,{size:"sm",placement:"right-end",children:[e.jsx(I,{children:e.jsx(S,{style:{position:"relative",zIndex:10,top:"100%",left:"5%",transform:"translate(-5%, -50%)",width:"20vh",height:"auto",userSelect:"none"},alt:t.firstname,src:t.avatar?c==null?void 0:c.id.toString():z,name:t.firstname,showFallback:!0})}),e.jsxs(V,{"aria-label":"avatar action",title:"Actions",children:[a.type==="self"&&t?e.jsx(j,{startContent:e.jsx(Q,{width:"1.25rem",height:"1.25rem"}),onPress:p,textValue:"Upload photo",children:e.jsx("span",{className:"font-medium",children:"Upload photo"})},"select-new-photo"):e.jsx(j,{className:"hidden",textValue:"hidden item",isReadOnly:!0}),a.type!=="self"&&t?e.jsx(j,{color:"danger",className:"text-danger",startContent:e.jsx(C,{width:"1.25rem",height:"1.25rem"}),textValue:"Report this user",children:e.jsx("span",{className:"font-medium",children:"Report this user"})},"report-this-user"):e.jsx(j,{className:"hidden",textValue:"hidden item",isReadOnly:!0})]})]})}),e.jsx(g,{style:{position:"relative",zIndex:10,top:"100%",left:"95%",transform:"translate(-95%, 50%)"},color:"primary",variant:"bordered",radius:"lg",children:"Edit your profile"}),e.jsx("div",{className:"flex items-center mt-16 dark:bg-black",style:{marginTop:"10vh",width:"90%",transform:"translate(5%, 0%)"},children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-4xl font-bold",children:[t.firstname," ",t.lastname,e.jsxs("span",{className:`${a.type!=="self"?"hidden":""} ml-3 font-normal text-small text-gray-500 dark:text-gray-400 hover:underline`,onClick:()=>u({...i,isOpen:!0}),children:["@",t.username||"SET YOUR USERNAME"]})]}),e.jsxs("p",{className:`${t.bio?"":"hidden"} font-medium`,children:["Bio:",e.jsx("span",{className:"ml-1 font-normal text-gray-600 dark:text-gray-300",children:t.bio})]}),e.jsxs("div",{className:"mt-5 whitespace-pre-wrap inline",children:[e.jsxs(v,{variant:"bordered",className:`${t.location?"mr-2":"hidden"}`,children:[e.jsx(Y,{width:"1rem",height:"1rem"}),e.jsx("span",{className:"ml-1",children:t.location})]}),e.jsxs(v,{variant:"bordered",className:`${t.birthday?"mt-1 mr-2":"hidden"}`,children:[e.jsx(G,{width:"1rem",height:"1rem"}),e.jsxs("span",{className:"ml-1",children:["Born ",b(t.birthday,y("universal"))]})]}),e.jsxs(v,{variant:"bordered",className:"mt-1",children:[e.jsx(J,{width:"1rem",height:"1rem"}),e.jsxs("span",{className:"ml-1",children:["Joined ",b(t.createdAt,y("joinDay"))]})]})]})]})})]})};export{xe as default};
